<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=9,IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <!--[if lt IE 9]>
    <script src="/gulp-test/common/js/respond.min.js"></script>
    <script src="/gulp-test/common/js/html5.min.js"></script>
    <![endif]-->
    <link rel="shortcut icon" href="/gulp-test/common/img/favicon.ico">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_1249487_zdiapo1zgcn.css">
    <link rel="stylesheet" type="text/css" href="/gulp-test/common/css/common.min.css">
    <link rel="stylesheet" type="text/css" href="/gulp-test/css/style.min.css">
    <script type="text/javascript" src="/gulp-test/common/js/sea.js"></script>
    <script type="text/javascript" src="/gulp-test/common/js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="/gulp-test/common/js/jquery.mockjax.min.js"></script>
    <script>
      $.mockjax({
        url: "/api/ajax",
        responseText: {
          code: 1,
          rdata: "返回数据",
          msg: '后台返回的信息'
        }
      });
      $.mockjax({
        url: '/api/ajax1',
        responseTime: 1000,
        responseText: {
          code: 1,
          rdata: "返回数据",
          msg: '后台返回的信息'
        }
      });
      // $.ajaxSetup({
      //   beforeSend: function(xhr) {
      //     console.log(this);
      //     console.log(xhr);
      //   }
      // });
      seajs.config({
        alias: {
          'jquery': 'jquery-3.3.1.js',
          'swiper': 'swiper.min.js',
          'common': 'common.js',
          'clipboard': 'clipboard.min.js',
          'select': 'mobileSelect/mobileSelect.min.js'
        }
      });
      $(function(){
        function htmlFont(){
          var baseWidth = 750;
          var deviceWidth = document.documentElement.clientWidth;
          deviceWidth>baseWidth && (deviceWidth=baseWidth);
          document.documentElement.style.fontSize = deviceWidth / baseWidth*100 + 'px';
        }
        htmlFont();
        $('body').show();
        var htmlFontSet = null;
        $(window).resize(function(){
          if(typeof(htmlFontSet)){clearTimeout(htmlFontSet)}
          htmlFontSet = setTimeout(htmlFont,500);
        });
      });
      /* 全局变量 */
      var $api = '/api/';
      var globalVar = {
        api: '/api/'
      }
    </script>
</head>
<body>
	<div class="shopcart main_page">
    <header class="fixed_top">
      <i class="iconfont iconleft back"></i>
      <span>Cart</span>
    </header>
    <div class="main">
      <ul class="shop_group">
        
        <li class="flex shadow_box">
          <div class="lf">
            <div class="img_box">
              <a href="#">
                <img src="../../image/img.jpg" alt="product">
              </a>
            </div>
            <div class="bottom flex">
              <i class="iconfont iconheart favorite"></i>
              <i class="iconfont icondel"></i>
            </div>
          </div>
          <div class="rt">
            <label class="check_box"><input type="checkbox" hidden><span></span></label>
            <p class="name title"><a href="#">Long-sleeved dress Long-sleeved dress Long-sleeved dress</a></p>
            <p class="info">Gifts/ Discounts/ Snaps</p>
            <p class="info">Product attribute SKU: UNAKU0606</p>
            <p class="attr"><span>Color</span><span>Size</span></p>
            <div class="price">
              <span class="now"><i>$</i>100</span>
              <span class="old"><i>$</i>139</span>
              <span class="integral">Integral: 119</span>
            </div>
            <div class="num_box">
              <span class="minus">-</span>
              <input type="number" value="1" data-price="100">
              <span class="add">+</span>
            </div>
          </div>
        </li>
        
        <li class="flex shadow_box">
          <div class="lf">
            <div class="img_box">
              <a href="#">
                <img src="../../image/img.jpg" alt="product">
              </a>
            </div>
            <div class="bottom flex">
              <i class="iconfont iconheart favorite"></i>
              <i class="iconfont icondel"></i>
            </div>
          </div>
          <div class="rt">
            <label class="check_box"><input type="checkbox" hidden><span></span></label>
            <p class="name title"><a href="#">Long-sleeved dress Long-sleeved dress Long-sleeved dress</a></p>
            <p class="info">Gifts/ Discounts/ Snaps</p>
            <p class="info">Product attribute SKU: UNAKU0606</p>
            <p class="attr"><span>Color</span><span>Size</span></p>
            <div class="price">
              <span class="now"><i>$</i>100</span>
              <span class="old"><i>$</i>139</span>
              <span class="integral">Integral: 119</span>
            </div>
            <div class="num_box">
              <span class="minus">-</span>
              <input type="number" value="1" data-price="100">
              <span class="add">+</span>
            </div>
          </div>
        </li>
        
        <li class="flex shadow_box">
          <div class="lf">
            <div class="img_box">
              <a href="#">
                <img src="../../image/img.jpg" alt="product">
              </a>
            </div>
            <div class="bottom flex">
              <i class="iconfont iconheart favorite"></i>
              <i class="iconfont icondel"></i>
            </div>
          </div>
          <div class="rt">
            <label class="check_box"><input type="checkbox" hidden><span></span></label>
            <p class="name title"><a href="#">Long-sleeved dress Long-sleeved dress Long-sleeved dress</a></p>
            <p class="info">Gifts/ Discounts/ Snaps</p>
            <p class="info">Product attribute SKU: UNAKU0606</p>
            <p class="attr"><span>Color</span><span>Size</span></p>
            <div class="price">
              <span class="now"><i>$</i>100</span>
              <span class="old"><i>$</i>139</span>
              <span class="integral">Integral: 119</span>
            </div>
            <div class="num_box">
              <span class="minus">-</span>
              <input type="number" value="1" data-price="100">
              <span class="add">+</span>
            </div>
          </div>
        </li>
        
        <li class="flex shadow_box">
          <div class="lf">
            <div class="img_box">
              <a href="#">
                <img src="../../image/img.jpg" alt="product">
              </a>
            </div>
            <div class="bottom flex">
              <i class="iconfont iconheart favorite"></i>
              <i class="iconfont icondel"></i>
            </div>
          </div>
          <div class="rt">
            <label class="check_box"><input type="checkbox" hidden><span></span></label>
            <p class="name title"><a href="#">Long-sleeved dress Long-sleeved dress Long-sleeved dress</a></p>
            <p class="info">Gifts/ Discounts/ Snaps</p>
            <p class="info">Product attribute SKU: UNAKU0606</p>
            <p class="attr"><span>Color</span><span>Size</span></p>
            <div class="price">
              <span class="now"><i>$</i>100</span>
              <span class="old"><i>$</i>139</span>
              <span class="integral">Integral: 119</span>
            </div>
            <div class="num_box">
              <span class="minus">-</span>
              <input type="number" value="1" data-price="100">
              <span class="add">+</span>
            </div>
          </div>
        </li>
        
        <li class="flex shadow_box">
          <div class="lf">
            <div class="img_box">
              <a href="#">
                <img src="../../image/img.jpg" alt="product">
              </a>
            </div>
            <div class="bottom flex">
              <i class="iconfont iconheart favorite"></i>
              <i class="iconfont icondel"></i>
            </div>
          </div>
          <div class="rt">
            <label class="check_box"><input type="checkbox" hidden><span></span></label>
            <p class="name title"><a href="#">Long-sleeved dress Long-sleeved dress Long-sleeved dress</a></p>
            <p class="info">Gifts/ Discounts/ Snaps</p>
            <p class="info">Product attribute SKU: UNAKU0606</p>
            <p class="attr"><span>Color</span><span>Size</span></p>
            <div class="price">
              <span class="now"><i>$</i>100</span>
              <span class="old"><i>$</i>139</span>
              <span class="integral">Integral: 119</span>
            </div>
            <div class="num_box">
              <span class="minus">-</span>
              <input type="number" value="1" data-price="100">
              <span class="add">+</span>
            </div>
          </div>
        </li>
        
      </ul>
      <div class="viewed flex">
        <span class="name">Recently viewed</span>
        <a href="#" class="all">SEE ALL</a>
      </div>
      <ul class="viewed_group flex">
        
        <li>
          <div class="img_box">
            <a href="#">
              <img src="../../image/img.jpg" alt="product">
            </a>
          </div>
        </li>
        
        <li>
          <div class="img_box">
            <a href="#">
              <img src="../../image/img.jpg" alt="product">
            </a>
          </div>
        </li>
        
        <li>
          <div class="img_box">
            <a href="#">
              <img src="../../image/img.jpg" alt="product">
            </a>
          </div>
        </li>
        
        <li>
          <div class="img_box">
            <a href="#">
              <img src="../../image/img.jpg" alt="product">
            </a>
          </div>
        </li>
        
      </ul>
    </div>
    <footer class="fixed_shop">
      <div class="lf">
        <!-- <span class="num">Number: <span>0</span></p> -->
        <p class="price">Pay: $<span>0.00</span></p>
      </div>
      <button class="btn" id="order">Complete my order</button>
    </footer>
  </div>
  <script>
    $(function(){
      var total = 0;
      var xhr = null;
      $('.shop_group').on('click', '.num_box span', function(){ //修改商品数量
        xhr && xhr.abort(); // 取消重复请求
        var $input = $(this).parent().find('input');
        var num = Number($input.val());
        if($(this).hasClass('add')){ //加
          $input.val(num+1);
          if($input.parents('.rt').find('.check_box input').prop('checked')){
            total += $input.data('price');
          }
        }else{ //减
          if(num>1){
            $input.val(num-1);
            if($input.parents('.rt').find('.check_box input').prop('checked')){
              total -= $input.data('price');
            }
          }
        }
        setPrice();
        xhr = $.get($api+'ajax1', function(res){
          console.log(res)
        });
      }).on('click', '.check_box input', function(){ // 是否选中
        var $input = $(this).parents('.rt').find('.num_box input');
        if($(this).prop('checked')){
          total += $input.data('price') * $input.val();
        }else{
          total -= $input.data('price') * $input.val();
        }
        setPrice()
      }).on('click', '.icondel', function(){ // 删除
        var $this = $(this);
        $confirm('remove from Cart', 'Are you sure you want to delete this item?', function(){
          $loading();
          $.get($api+'ajax1', function(res){
            $this.parents('li').remove();
            if($this.parents('li').find('.check_box input').prop('checked')){
              var $input = $this.parents('li').find('.num_box input');
              total -= $input.data('price') *  $input.val();
              setPrice();
            }
            $endloading();
          });
        })
      }).on('click', '.favorite', function(){ // 收藏
        var $this = $(this);
        $loading();
        $.get($api+'ajax1', function(res){
          if($this.hasClass('iconhearts')){ // 取消收藏
            $this.addClass('iconheart').removeClass('iconhearts')
          }else{ // 收藏
            $this.addClass('iconhearts').removeClass('iconheart')
          }
          $endloading();
        })
      });
      function setPrice() { // 总价更新
        total = total<0?0:total;
        $('.fixed_shop .price span').text(total.toFixed(2))
      }
      $('#order').click(function(){ //跳转订单页面
        window.location.href = './order.html';
      });
    })
  </script>
    
    <script src="/gulp-test/common/js/common.js" type="text/javascript"></script>
</body>
</html>